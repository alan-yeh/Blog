---
layout: post
date: 2016-01-08
title: PSLog æ›´å¥½çš„æ—¥å¿—å·¥å…·
tags: Objective-C
---

ã€€ã€€ä½ è¿˜åœ¨ç”¨ç€NSLogæ¥åšæ—¥å¿—è¾“å‡ºå§ï¼Ÿæœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œæ—¥å¿—å…¶å®è¿˜å¯ä»¥æ›´å¼ºå¤§å‘¢ï¼ŸPSLogä¾¿å¯ä»¥æˆä¸ºä½ çš„æ–°çš„Debugåˆ©å™¨ã€‚

ã€€ã€€PSLogæ˜¯ä¸€ä¸ªå¯è‡ªå®šä¹‰åŒ–ï¼Œå¹¶å¯ä»¥æä¾›ä¸€äº›æ–¹ä¾¿çš„è°ƒè¯•ä¸è®°å½•çš„åŠŸèƒ½çš„æ—¥å¿—å·¥å…·ã€‚å®ƒä¸NSLogçš„ç”¨æ³•å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼Œæ‰€ä»¥æ²¡æœ‰å­¦ä¹ çš„éš¾åº¦ã€‚PSLogå¯ä»¥å°†æ—¥å¿—è¾“å‡ºåˆ°ä¸åŒçš„åœ°æ–¹ï¼Œé»˜è®¤å®ç°äº†`PSConsoleLogger`ã€`PSFileLogger`ã€`PSSQLiteLogger`ä¸‰ç±»æ—¥å¿—å·¥å…·ï¼Œé»˜è®¤ä½¿ç”¨PSConsoleLoggerï¼ˆè¾“å‡ºåˆ°æ§åˆ¶å°ï¼‰ã€‚

### 1 PSLogçš„ä½¿ç”¨
---
ã€€ã€€PSLogçš„ä½¿ç”¨æ–¹æ³•ä¸NSLogæ˜¯ä¸€æ ·çš„ï¼Œä½†PSLogæä¾›4ä¸ªçº§åˆ«æ—¥å¿—ï¼Œåˆ†åˆ«ä¸ºDEBUGã€INFOã€WARNINGã€ERRORã€‚

```objective-c
    PSLog(@"hello");//é»˜è®¤ä½¿ç”¨PSLogD
    PSLogD(@"hello");//DEBUG
    PSLogI(@"hello");//INFO
    PSLogW(@"hello");//WARNING
    PSLogE(@"hello");//ERROR
```
ã€€ã€€ç”¨æˆ·å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€å…³é—­æˆ–æ‰“å¼€å“ªäº›çº§åˆ«çš„æ—¥å¿—ï¼Œä»¥æ–¹ä¾¿è°ƒè¯•ã€‚

```objective-c
//ä»¥ä¸‹å‘½ä»¤æ˜¯åœ¨ç¨‹åºä¸­æ–­ç‚¹æ—¶ï¼Œåœ¨consoleè¾“å…¥
//åªè¾“å‡ºDEBUGçº§æ—¥å¿—
e [PSLog enable:1];
//åªè¾“å‡ºWARNINGçº§æ—¥å¿—
e [PSLog enable:4];
//åŒæ—¶è¾“å‡ºERRORã€WARNINGçº§æ—¥å¿—
e [PSLog enable:12];
```
> `[PSLog enable:12]`å®é™…ä¸Šæ˜¯æ‰§è¡Œ`[PSLog enable: PSLogLevelERROR | PSLogLevelWARNING]`

### 2 åˆ‡æ¢æ—¥å¿—è¾“å‡º
---
ã€€ã€€PSLogè‡ªå¸¦ä¸‰ç§è¾“å‡ºæ–¹å¼ï¼Œåˆ«åˆ†ä¸ºPSConsoleLogger(æ§åˆ¶å°è¾“å‡ºï¼Œé»˜è®¤ï¼‰ã€PSFileLogger(æ–‡ä»¶è¾“å‡º)ã€PSSQLiteLogger(SQLiteè¾“å‡º)ã€‚ç”¨æˆ·å¯ä»¥åœ¨åº”ç”¨å¯åŠ¨æ—¶è®¾ç½®æ—¥å¿—è¾“å‡ºæ–¹å¼ã€‚

```objective-c
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    //å°†PSLogçš„æ—¥å¿—è¾“å…¥åˆ°SQLiteä¸­
    [PSLog use:[[PSSQLiteLogger alloc] initWithDatasource:[[PSFile documents] child:@"log.db"].path]];
}
```
##### PSConsoleLogger
ã€€ã€€PSConsoleLoggerå°†æ—¥å¿—ç›´æ¥è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚è¾“å‡ºæ ·å¼åˆ†åˆ«å¯¹åº”DEBUG/INFO/WARNING/ERRORï¼Œå¦‚ä¸‹ï¼š

```
ğŸğŸ2016-01-10 16:12:46.320 -[ViewController clicked:] (ViewController.m: 98)
hello
=========================================
âœï¸âœï¸2016-01-10 16:12:46.323 -[ViewController clicked:] (ViewController.m: 99)
hello
=========================================
âš ï¸âš ï¸2016-01-10 16:12:46.323 -[ViewController clicked:] (ViewController.m: 100)
hello
=========================================
âŒâŒ2016-01-10 16:12:46.323 -[ViewController clicked:] (ViewController.m: 101)
hello
=========================================
```
##### PSFileLogger
ã€€ã€€PSFileLoggerå°†æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”æ ¹æ®æ—¶é—´å°†æ—¥å¿—è¾“å‡ºåˆ°ä¸åŒçš„æ–‡ä»¶ä¸­ã€‚

```objective-c
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    //å°†PSLogçš„æ—¥å¿—è¾“å…¥åˆ°Documents/logæ–‡ä»¶å¤¹ä¸­
    [PSLog use:[[PSFileLogger alloc] initWithSavePath:[[PSFile documents] child:@"log"]]];
}
```
ã€€ã€€PSFileLoggeré»˜è®¤æ¯ä¸ªå°æ—¶æ–°å»ºä¸€ä¸ªæ–‡ä»¶ç”¨äºè®°å½•æ—¥å¿—ã€‚
##### PSSQLiteLogger
ã€€ã€€PSSQLiteLoggerå°†æ—¥å¿—è¾“å‡ºåˆ°SQLiteä¸­ã€‚

```objective-c
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    //å°†PSLogçš„æ—¥å¿—è¾“å…¥åˆ°Documents/logæ–‡ä»¶å¤¹ä¸­
    [PSLog use:[[PSSQLiteLogger alloc] initWithDatasource:[[PSFile documents] child:@"log.db"].path]];
}
```
ã€€ã€€PSSQLiteLoggeræä¾›äº†ç®€æ˜“çš„æ—¥å¿—æŸ¥è¯¢ã€‚

```objective-c
NSArray<PSLogRecord *> *logs = [PSSQLiteLogger allLogs];
NSArray<PSLogRecord *> *logs = [PSSQLiteLogger logsBetween:beginDate and:endDate];
```
> PSSQLiteLoggerä½¿ç”¨PSDicRecordä½œä¸ºSQLiteç®¡ç†å·¥å…·ï¼Œç”¨æˆ·å¯ä»¥å­¦ä¹ PSDicRecordä¹‹åä½¿ç”¨æ›´å¤šçš„æ–¹å¼æŸ¥è¯¢æ—¥å¿—ã€‚

### 3 è‡ªå®šä¹‰Logger
---
ã€€ã€€å¼€å‘è€…å¯ä»¥è‡ªè¡Œå®ç°Loggerï¼Œå®ç°`PSLogger`åè®®ï¼Œå¹¶æ³¨å†Œåˆ°PSLogä¸­ï¼Œå®ç°å„ç§è‡ªå®šè®®æ—¥å¿—æ ¼å¼æˆ–è¾“å…¥ç­‰éœ€æ±‚ã€‚

```objective-c
@protocol PSLogger <NSObject>
- (void)logLevel:(PSLogLevel)level func:(const char *)func file:(const char *)file line:(NSInteger)line message:(NSString *)msg;
@end
```
### 4 å¢å¼ºNSLog
---
ã€€ã€€åœ¨PSLogçš„å¤´æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶ä¹Ÿå¢å¼ºäº†NSLogï¼Œè¾“å‡ºNSLogæ‰€åœ¨ç±»ã€æ–¹æ³•ã€æºæ–‡ä»¶ååŠè¡Œå·ï¼Œæ–¹ä¾¿å¼€å‘è€…å®šä½é—®é¢˜ï¼Œå¦‚ä¸‹

```
ğŸğŸ-[ViewController clicked:] (ViewController.m: 56) 
2015-12-29 14:15:21.784 UnitCase[2207:113098] æ—¥å¿—æµ‹è¯•
=========================================
ğŸğŸ-[ViewController clicked:] (ViewController.m: 58) 
2015-12-29 14:15:21.785 UnitCase[2207:113098] æ—¥å¿—æµ‹è¯•
=========================================
ğŸğŸ-[ViewController delay] (ViewController.m: 63) 
2015-12-29 14:15:24.787 UnitCase[2207:113098] æ—¥å¿—æµ‹è¯•
=========================================
```
### 5 å…³é—­æ—¥å¿—
---
ã€€ã€€ç”¨æˆ·åªéœ€è¦åœ¨`.pchå¤´æ–‡ä»¶`ä¸­ä½¿ç”¨å®å®šä¹‰ï¼Œå³å¯å…¨å±€å…³é—­æ—¥å¿—åŠŸèƒ½

```objective-c
//å…¨å±€å…³é—­PSLog
PS_LOG_OFF
//å…¨å±€å…³é—­NSLOG
NS_LOG_OFF
```
### 6 å…¶å®ƒ
---
ã€€ã€€PSLogè¿˜æä¾›ä¸€äº›æ¯”è¾ƒå®ç”¨çš„å®å®šä¹‰ï¼š`PSLogTodo`å’Œ`PSLogWarning`ï¼Œè¿™ä¸¤ä¸ªå°†åœ¨æ§åˆ¶å°ä¸­ç›´æ¥è¾“å‡ºè°ƒè¯•ä¿¡æ¯

```
//PSLogTodo(@"yerl", @"å›æ¥ä¿®æ”¹æ­¤æ–¹æ³•");
âœ…âœ…TODO by yerl: å›æ¥ä¿®æ”¹æ­¤æ–¹æ³• (ViewController.m:53)

//PSLogWarning(@"yerl", @"æœ‰å†…å­˜æ³„éœ²é£é™©");
âš ï¸âš ï¸WARNING by yerl: æœ‰å†…å­˜æ³„éœ²é£é™© (ViewController.m:57)
```